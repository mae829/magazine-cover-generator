jQuery(function(e){var a=e('form[name="mcg-cover"]'),t=a.find('input[type="file"]'),n=a.find('input[type="submit"]');n.hide(),t.on("change",function(){""!==e(this).val()&&n.show()}),e("#canvas").length&&e(window).on("load",function(){canvas=window.__canvas=new fabric.Canvas("canvas"),canvas.controlsAboveOverlay=!0,canvas.backgroundColor="#fff";e(window).width();var a=e("#img-edit").width(),t=1;a<mask.width?(t=a/mask.width,canvas.setWidth(a-10),canvas.setHeight(t*mask.height)):(canvas.setWidth(mask.width),canvas.setHeight(mask.height)),fabric.Object.prototype.transparentCorners=!1;var n=new Image;n.crossOrigin="anonymous",n.onload=function(){fabric.Image.fromURL(mask.src,function(e){mask=e.set({lockScalingFlip:!0,lockUniScaling:!0,left:canvas.width/2-e.width/2*t,top:canvas.height/2-e.height/2*t,width:1!==t?t*mask.width:mask.width,height:1!==t?t*mask.height:mask.height,angle:0,evented:!0,selectable:!1,opacity:mask.opacity,scale:t}),canvas.setOverlayImage(mask,canvas.renderAll.bind(canvas))})},n.src=mask.src,fabric.Image.fromURL(userImage.src,function(e){e.height>e.width?(userImage.height,e.height):(userImage.width,e.width);var a=e.width,t=e.height;a>canvas.width-75?e.scaleToWidth(canvas.width-75):t>canvas.height-75&&e.scaleToHeight(canvas.height-75),e.set({lockScalingFlip:userImage.lockScalingFlip,lockUniScaling:userImage.lockUniScaling,angle:userImage.angle,opacity:userImage.opacity,scale:userImage.scale,evented:userImage.evented,hasControls:userImage.hasControls,selectable:userImage.selectable,rotationIncrement:userImage.rotationIncrement,movementIncrement:userImage.movementIncrement,scaleIncrement:userImage.scaleIncrement}),canvas.add(e).setActiveObject(e).centerObject(e)},{crossOrigin:""}),canvas.renderAll(),document.getElementById("btn-download").addEventListener("click",function(){canvas.deactivateAll().renderAll(),this.href=document.getElementById("canvas").toDataURL(),this.download="mcg-custom.jpg"},!1),e(".color-field").wpColorPicker({defaultColor:colorPickerPalette[0],palettes:colorPickerPalette,change:function(e,a){var t=a.color.toString();canvas.setBackgroundColor(t,canvas.renderAll.bind(canvas))}}),e("input[type=checkbox][name=inverttext]").change(function(){var a=this.checked,n=e("input[type=radio][name=canvasmask]:checked").val(),i=new Image;i.crossOrigin="anonymous",i.onload=function(){fabric.Image.fromURL(n,function(e){a&&(e.filters.push(new fabric.Image.filters.InvertHeadlines),e.applyFilters(canvas.renderAll.bind(canvas))),e.set({lockScalingFlip:!0,lockUniScaling:!0,left:canvas.getWidth()/2-e.width/2*t,top:canvas.getHeight()/2-e.height/2*t,width:1!==t?t*e.width:e.width,height:1!==t?t*e.height:e.height,angle:0,evented:!0,selectable:!1,opacity:1,scale:t}),canvas.setOverlayImage(e,canvas.renderAll.bind(canvas))},{crossOrigin:""})},i.src=n}),e("input[type=radio][name=canvasmask]").change(function(){e("input[type=checkbox][name=inverttext]").removeAttr("checked");var a=this.value,n=new Image;n.crossOrigin="anonymous",n.onload=function(){fabric.Image.fromURL(a,function(e){e.set({lockScalingFlip:!0,lockUniScaling:!0,left:canvas.getWidth()/2-e.width/2*t,top:canvas.getHeight()/2-e.height/2*t,width:1!==t?t*e.width:e.width,height:1!==t?t*e.height:e.height,angle:0,evented:!0,selectable:!1,opacity:mask.opacity,scale:t}),canvas.setOverlayImage(e,canvas.renderAll.bind(canvas))},{crossOrigin:""})},n.src=a})})}),function(e){"use strict";var a=e.fabric||(e.fabric={}),t=a.Image.filters,n=a.util.createClass;t.InvertHeadlines=n(t.BaseFilter,{type:"InvertHeadlines",applyTo:function(e){for(var a=e.getContext("2d"),t=a.getImageData(0,0,e.width,e.height),n=t.data,i=(n.length,invertPoint.y);i<=e.height;i++)for(var c=invertPoint.x;c<=e.width;c++){var s=4*(e.width*i+c);n[s]=255-n[s],n[s+1]=255-n[s+1],n[s+2]=255-n[s+2]}a.putImageData(t,0,0)}}),a.Image.filters.InvertHeadlines.fromObject=function(e,t){return e=e||{},e.type="InvertHeadlines",a.Image.filters.BaseFilter.fromObject(e,t)}}("undefined"!=typeof exports?exports:this);