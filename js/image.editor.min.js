$(function(){var e=$('form[name="mcg-cover"]'),a=e.find('input[type="file"]'),t=e.find('input[type="submit"]');t.hide(),a.on("change",function(){""!==$(this).val()&&t.show()})}),$("#canvas").length&&($(window).on("load",function(){canvas=window.__canvas=new fabric.Canvas("canvas"),canvas.controlsAboveOverlay=!0,canvas.backgroundColor="#fff";$(window).width();var e=$("#img-edit").width(),a=1;e<mask.width?(a=e/mask.width,canvas.setWidth(e-10),canvas.setHeight(a*mask.height)):(canvas.setWidth(mask.width),canvas.setHeight(mask.height)),fabric.Object.prototype.transparentCorners=!1;var t=new Image;t.crossOrigin="anonymous",t.onload=function(){fabric.Image.fromURL(mask.src,function(e){mask=e.set({lockScalingFlip:!0,lockUniScaling:!0,left:canvas.width/2-e.width/2*a,top:canvas.height/2-e.height/2*a,width:1!==a?a*mask.width:mask.width,height:1!==a?a*mask.height:mask.height,angle:0,evented:!0,selectable:!1,opacity:mask.opacity,scale:a}),canvas.setOverlayImage(mask,canvas.renderAll.bind(canvas))})},t.src=mask.src,fabric.Image.fromURL(userImage.src,function(e){e.height>e.width?(userImage.height,e.height):(userImage.width,e.width);var a=e.width,t=e.height;a>canvas.width-75?e.scaleToWidth(canvas.width-75):t>canvas.height-75&&e.scaleToHeight(canvas.height-75),e.set({lockScalingFlip:userImage.lockScalingFlip,lockUniScaling:userImage.lockUniScaling,angle:userImage.angle,opacity:userImage.opacity,scale:userImage.scale,evented:userImage.evented,hasControls:userImage.hasControls,selectable:userImage.selectable,rotationIncrement:userImage.rotationIncrement,movementIncrement:userImage.movementIncrement,scaleIncrement:userImage.scaleIncrement}),canvas.add(e).setActiveObject(e).centerObject(e)},{crossOrigin:""}),canvas.renderAll(),document.getElementById("btn-download").addEventListener("click",function(){canvas.deactivateAll().renderAll(),this.href=document.getElementById("canvas").toDataURL(),this.download="mcg-custom.jpg"},!1),$(".color-field").wpColorPicker({defaultColor:colorPickerPalette[0],palettes:colorPickerPalette,change:function(e,a){var t=a.color.toString();canvas.setBackgroundColor(t,canvas.renderAll.bind(canvas))}}),$("input[type=checkbox][name=inverttext]").change(function(){var e=this.checked,t=$("input[type=radio][name=canvasmask]:checked").val(),n=new Image;n.crossOrigin="anonymous",n.onload=function(){fabric.Image.fromURL(t,function(t){e&&(t.filters.push(new fabric.Image.filters.InvertHeadlines),t.applyFilters(canvas.renderAll.bind(canvas))),t.set({lockScalingFlip:!0,lockUniScaling:!0,left:canvas.getWidth()/2-t.width/2*a,top:canvas.getHeight()/2-t.height/2*a,width:1!==a?a*t.width:t.width,height:1!==a?a*t.height:t.height,angle:0,evented:!0,selectable:!1,opacity:1,scale:a}),canvas.setOverlayImage(t,canvas.renderAll.bind(canvas))},{crossOrigin:""})},n.src=t}),$("input[type=radio][name=canvasmask]").change(function(){$("input[type=checkbox][name=inverttext]").removeAttr("checked");var e=this.value,t=new Image;t.crossOrigin="anonymous",t.onload=function(){fabric.Image.fromURL(e,function(e){e.set({lockScalingFlip:!0,lockUniScaling:!0,left:canvas.getWidth()/2-e.width/2*a,top:canvas.getHeight()/2-e.height/2*a,width:1!==a?a*e.width:e.width,height:1!==a?a*e.height:e.height,angle:0,evented:!0,selectable:!1,opacity:mask.opacity,scale:a}),canvas.setOverlayImage(e,canvas.renderAll.bind(canvas))},{crossOrigin:""})},t.src=e})}),function(e){"use strict";var a=e.fabric||(e.fabric={}),t=a.Image.filters,n=a.util.createClass;t.InvertHeadlines=n(t.BaseFilter,{type:"InvertHeadlines",applyTo:function(e){for(var a=e.getContext("2d"),t=a.getImageData(0,0,e.width,e.height),n=t.data,i=(n.length,165);i<=e.height;i++)for(var c=0;c<=e.width;c++){var s=4*(e.width*i+c);n[s]=255-n[s],n[s+1]=255-n[s+1],n[s+2]=255-n[s+2]}a.putImageData(t,0,0)}}),a.Image.filters.InvertHeadlines.fromObject=function(e,t){return e=e||{},e.type="InvertHeadlines",a.Image.filters.BaseFilter.fromObject(e,t)}}("undefined"!=typeof exports?exports:this));